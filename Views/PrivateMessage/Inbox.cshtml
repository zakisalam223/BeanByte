@model IEnumerable<forum_aspcore.Models.FPrivateMessage>

@{
    ViewData["Title"] = "Inbox";
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
        @TempData["ErrorMessage"]
    </div>
}

<div class="container-fluid mx-auto px-4 py-12 max-w-7xl">
    <div class="mb-8 text-center">
        <h1 class="text-4xl font-extrabold text-coffee-cream mb-4">Messages</h1>
    </div>

    <div class="mb-8">
        <nav class="flex justify-center space-x-4" aria-label="Tabs">
            <a href="@Url.Action("Inbox")" 
               class="px-4 py-2 font-medium @(ViewContext.RouteData.Values["action"].ToString() == "Inbox" ? "border-2 border-black bg-pale-green text-white" : "text-coffee-cream hover:bg-coffee-brown") focus:outline-none focus:ring-2 focus:ring-pale-green">
                Inbox
            </a>
            <a href="@Url.Action("Sent")" 
                class="px-4 py-2 font-medium @(ViewContext.RouteData.Values["action"].ToString() == "Sent" ? "border-2 border-black bg-pale-green text-white" : "text-coffee-cream hover:bg-coffee-brown") focus:outline-none focus:ring-2 focus:ring-pale-green">
                Sent
            </a>
        </nav>
        
    </div>
        <div class="mb-6">
        <form asp-action="Send" method="get">
            <div class="flex flex-col sm:flex-row sm:space-x-4 space-y-4 sm:space-y-0">
                <div class="flex-grow">
                    <label for="recipientUsername" class="sr-only">Recipient Username</label>
                    <input id="recipientUsername" name="recipientUsername" type="text" placeholder="Enter Recipient Username" 
                           class="appearance-none rounded-md relative block w-full px-3 py-2 border border-coffee-brown-light bg-coffee-brown-dark text-coffee-cream placeholder-coffee-cream focus:outline-none focus:ring-pale-green focus:border-pale-green sm:text-sm" 
                           required />
                </div>
                <button type="submit" class="border border-black w-full sm:w-auto inline-flex justify-center px-4 py-2 bg-pale-green text-white font-medium hover:bg-pale-green-dark focus:outline-none focus:ring-2 focus:ring-pale-green">
                    Send Private Message
                </button>
            </div>
        </form>
    </div>

    @if (!Model.Any())
    {
        <div class="bg-coffee-brown-dark text-center py-16">
            <p class="text-lg font-medium text-coffee-cream">No messages found in your inbox.</p>
        </div>
    }
    else
    {
        <div class="overflow-x-auto bg-coffee-brown-dark">
            <table class="w-full border-collapse border-2 border-coffee-brown-light">
                <thead class="bg-coffee-brown-dark">
                    <tr>
                        <th class="border border-coffee-brown-light px-4 py-2 text-left text-sm font-medium text-coffee-cream">@(ViewContext.RouteData.Values["action"].ToString() == "Sent" ? "To" : "From")</th>
                        <th class="border border-coffee-brown-light px-4 py-2 text-left text-sm font-medium text-coffee-cream">Message Preview</th>
                        <th class="border border-coffee-brown-light px-4 py-2 text-left text-sm font-medium text-coffee-cream">Date Sent</th>
                        <th class="border border-coffee-brown-light px-4 py-2 text-left text-sm font-medium text-coffee-cream">Status</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var message in Model)
                    {
                        <tr class="odd:bg-coffee-brown-dark even:bg-coffee-brown hover:bg-coffee-brown-light cursor-pointer" 
                            onclick="window.location.href='@Url.Action("Details", "PrivateMessage", new { id = message.MessageID })'">
                            <td class="border border-coffee-brown-light px-4 py-2 text-coffee-cream">
                                @(ViewContext.RouteData.Values["action"].ToString() == "Sent" ? message.RecipientUsername : message.SenderUsername)
                            </td>
                            <td class="border border-coffee-brown-light px-4 py-2 text-coffee-cream">
                                @(message.Content.Length > 50 ? message.Content.Substring(0, 47) + "..." : message.Content)
                            </td>
                            <td class="border border-coffee-brown-light px-4 py-2 text-coffee-cream">@message.DateSent.ToString("MMM dd, yyyy h:mm tt")</td>
                            <td class="border border-coffee-brown-light px-4 py-2 text-coffee-cream">
                                @(message.Status ? "Read" : "Unread")
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>
